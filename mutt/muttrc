#=Boring Details=======================================#

set realname = "James Baumgarten"
set folder=~/.mutt/mail
source ~/.mutt/mailboxes
source ~/.mutt/colors/ivyleague.muttrc
set use_from = yes
set envelope_from ="yes"

set header_cache = ~/.cache/mutt
set message_cachedir = ~/.cache/mutt

set mail_check=5  # mutt checks for new mails on every keystroke, not more than once per 5 seconds
set beep_new = yes
set sleep_time = 0
set wait_key = no
#=Folders==============================================#

set date_format="%m/%d %T"
#set index_format="%2C%Z (%D) %-30.30F (%-4.4c) %s"
set index_format="%2C%5Z (%D) %-30.30F  %s"
set mbox_type=Maildir
set move=no                   # Don't move mail from spool
set mask="!^\\.[^.]"
set sort_browser=alpha        # Sort mailboxes by alpha(bet)
source ~/.mutt/jebaumg.muttrc # Startup folder
#=Headers==============================================#

ignore *
unignore Date: From: User-Agent: \
         Cc: Reply-To: Subject: Mail-Followup-To:
hdr_order Date From Subject To CC
set sort=threads
set sort_browser=reverse-date
set sort_aux=reverse-last-date-received
#=Editor / Composition=================================#

set editor="vim"
set edit_headers=yes  # See the headers when editing
set include=yes                      # include message in replies
set forward_quote=yes                # include message in forwards
set forward_format = "Fwd: %s"       # format of subject when forwarding
set attribution = "On %d, %n wrote:" # format of quoting header
set copy=yes
set delete=yes
set confirmappend=no
set fast_reply=yes                   # skip to compose when replying
#=Aliases==============================================#

set alias_file = ~/.mutt/aliases # In their own file
source ~/.mutt/aliases           # Source them
set sort_alias=alias             # Sort alphabetically
#=Odds and Ends========================================#

set markers          # mark wrapped lines of text in the pager with a +
set smart_wrap       # Don't wrap mid-word
set pager_context=5  # Retain 5 lines of previous page when scrolling.
set status_on_top    # Status bar on top.
push <show-version>  # Shows mutt version at startup
set duplicate_threads = yes
set mailcap_path  = ~/.mutt/mailcap
auto_view text/html
set thorough_search

folder-hook ~/.mutt/mail/jebaumg/*  source ~/.mutt/jebaumg.muttrc
folder-hook ~/.mutt/mail/jbaumy/*   source ~/.mutt/jbaumy.muttrc
folder-hook ~/.mutt/mail/neurionb/* source ~/.mutt/neurionb.muttrc
#=Status Bar===========================================#

set status_chars  = " *%A"
set status_format = "───[ Folder: %f ]───[%r%M messages%?V? (%V)? %L%?u? (%u new)?%?d? (%d to delete)?%?t? (%t tagged)? ]───%>─%?p?( %p postponed )?───"
#=Sidebar==============================================#

set sidebar_delim   = '│'
set sidebar_visible = yes
set sidebar_width   = 24
color sidebar_new color221 color233
set sidebar_shortpath=yes
#=Pager================================================#

set pager_index_lines = 10 # number of index lines to show
set pager_context = 3      # number of context lines to show
set pager_stop             # don't go to next message automatically
set menu_scroll            # scroll in menus
set tilde                  # show tildes like in vim
unset markers              # no ugly plus signs

set quote_regexp = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"
alternative_order text/plain text/enriched text/html
#=Macros===============================================#

macro index,pager \e1 "<enter-command>source ~/.mutt/neurionb.muttrc<enter><change-folder>~/.mutt/mail/neurionb/INBOX<enter>"
macro index,pager \e2 "<enter-command>source ~/.mutt/jebaumg.muttrc<enter><change-folder>~/.mutt/mail/jebaumg/INBOX<enter>"
macro index,pager \e3 "<enter-command>source ~/.mutt/jbaumy.muttrc<enter><change-folder>~/.mutt/mail/jbaumy/INBOX<enter>"

macro index a "<limit>all\n" "show all messages (undo limit)"
macro index,pager c "<change-folder>?<toggle-mailboxes>" "open a different folder"
macro index,pager b '<enter-command>toggle sidebar_visible<enter><refresh>'

macro index S "<enter-command>unset wait_key<enter><shell-escape>notmuch-mutt --prompt search<enter><change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter>" \
    "notmuch: search mail"

macro index <F5> "<enter-command>source ~/.mutt/colors/ivyleague.muttrc<enter>"

macro index <F6> "<enter-command>unset wait_key<enter><enter-command>unignore message-id<enter><pipe-message>notmuch-mutt -- tag -inbox<enter>" \
    "remove message from inbox with notmuch"

macro index <F9> "<enter-command>unset wait_key<enter><enter-command>unignore message-id<enter><pipe-message>notmuch-mutt thread<enter><change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter><enter-command>set wait_key<enter>" \
    "search and reconstruct owning thread with notmuch"
#=Keybinds=============================================#

bind  attach  <return> view-mailcap
macro attach  S        <save-entry><kill-line>/home/james/<return>a

bind  browser,postpone,alias,attach  i  previous-entry
bind  browser,postpone,alias,attach  k  next-entry
bind  browser,postpone,alias,attach  g  first-entry
bind  browser,postpone,alias,attach  G  last-entry

bind compose p        postpone-message # postpone message from sending screen
bind index   p        recall-message

bind index,pager \Cp   sidebar-prev
bind index,pager \Cn   sidebar-next
bind index,pager \Co   sidebar-open
bind index,pager \Cu   half-up
bind index,pager \Cd   half-down
bind index,pager R     group-reply
bind index,pager \eD   delete-thread
bind index,pager \eU   undelete-thread
bind index,pager \Cb   previous-page
bind index,pager \Cf   next-page
bind index,pager N     search-opposite # override default 'N' that marks as new for more vimlike searching

# ^U and ^D were bound otherwise, so bind it now again to something else
bind pager <Home>   top
bind pager g        top
bind pager <End>    bottom
bind pager G        bottom
bind pager q        exit
bind pager j        exit
bind pager <Up>     previous-line
bind pager i        previous-line
bind pager <Down>   next-line
bind pager k        next-line
bind pager I        previous-entry
bind pager K        next-entry

bind index <Home>  first-entry
bind index g       first-entry
bind index <End>   last-entry
bind index G       last-entry
bind index i       previous-entry
bind index k       next-entry
bind index l       display-message
bind index L       limit
bind index B       bounce-message
bind index \ef     forget-passphrase
bind index <space> collapse-thread

macro index \Cr "T~U<enter><tag-prefix><clear-flag>N<untag-pattern>.<enter>" "mark all messages as read"
macro index <esc>r "T~N<enter>;WNT~O<enter>;WO\CT~T<enter>" "mark all messages read"
macro index O "<shell-escape>offlineimap<enter>"           "run offlineimap to sync all mail"
macro index C "<copy-message>?<toggle-mailboxes>" "copy a message to a mailbox"
macro index M "<save-message>?<toggle-mailboxes>" "move a message to a mailbox"
